# 知识库
## 1.1.1 知识库相关理论
### 1.1.1 什么是知识库

知识库（Knowledge Base, KB）是智能体系统中用于**长期记忆与知识支持**的核心模块，本质上是一个**结构化的语义信息集合**。它将文本、文档、问答对、规则或知识片段以特定形式存储，供 AI 调用以支持推理、回答问题和行为决策。

---

#### （1）知识库的定义

知识库是指**一系列文档或数据集合**的组织载体。它并非简单的信息堆积，而是经过**结构化、分段、向量化或索引处理**的内容集，使得智能体系统可以**快速、准确地进行匹配、理解与调用**。这些文档可以包括 FAQ、技术文档、产品手册、业务规则、案例记录等。

> 📌 例子：一个面向客服场景的知识库可能包含“退款流程”、“物流进度查询”、“订单修改规则”等文档，经过拆解和处理后，智能体便能精准检索并生成自然语言回复。

在智能体系统中，知识库承担着类似“长期记忆”的角色：

- **信息存储**：可持久保存大量结构化或半结构化的知识。
- **语义检索与召回**：配合嵌入模型（Embedding Model）将文本转为向量形式，支持语义级别的模糊查询；
- **增强智能体回答能力**：通过与大模型结合，实现“检索增强生成”（RAG）机制，提升问答的准确性与知识覆盖；
- **上下文支撑**：为任务执行（如流程规则、推荐、生成式回复）提供知识背景，增强模型执行力。
### （2）知识库的基本构成

- **文档数据（Raw Documents）**：用户上传的原始资料；
- **分段处理（Chunking）**：根据语义或格式将文档划分为更小片段；
- **向量化索引（Embedding & Vector DB）**：将文本转为向量，并存入向量数据库；
- **召回策略（Retrieval Strategy）**：使用语义搜索算法（如余弦相似度、Hybrid Search）进行知识匹配；
- **上下文注入（Context Injection）**：将召回结果以提示词形式融合到 LLM 输入中，供模型理解与回答。

---

### （3）知识库 vs 大模型的差异与互补

| 项目 | 大语言模型（LLM） | 知识库（Knowledge Base） |
|------|--------------------|---------------------------|
| 知识来源 | 预训练语料 | 用户自定义文档 |
| 更新频率 | 固定训练周期 | 可随时动态更新 |
| 回答可信度 | 概率生成，无法追踪溯源 | 可溯源、有据可查 |
| 应用场景 | 泛知识生成 | 精准知识问答、业务流程支撑 |

### 1.1.2 调取知识库逻辑

智能体（Agent）并非凭空回答问题。它的高质量响应往往来源于对“外部知识”的有效调用与加工。Agent 调取知识库的过程，就是“从外部长期记忆中找答案，再由大模型加工润色”的过程，其核心在于**语义检索**与**上下文融合**。

下面是一个典型的智能体调取知识库的流程逻辑：

---

#### ① 用户提出查询（Query）

用户通过 Chat Interface 提出问题，如“公司如何报销差旅费？”——这是整个流程的起点。

---

#### ② 查询向量化（Embedding）

将用户的问题输入 Embedding 模型，转化为一个高维语义向量。例如：

```text
输入：公司如何报销差旅费？
输出：Query Vector = [0.43, 0.11, ..., 0.92]
```

该过程确保语义层面的匹配，而不仅是关键词匹配。

#### ③ 知识库内容预处理

知识库在预先准备阶段会经历如下步骤：

- **文本切分（Chunking）**：将文档划分成段落、FAQ对、规则块等；
- **向量编码**：用相同的 Embedding 模型处理每个文本片段，生成并存储向量；
- **建立索引**：通过向量索引结构（如 Faiss、Milvus）构建语义检索能力。

---

#### ④ 语义召回（Vector Retrieval）

Agent 使用向量数据库进行**近似最近邻搜索（ANN）**，找到与 Query 最接近的几个文本块（通常是 3~5 个）：

- 检索方法可选：余弦相似度、Dot Product、Hybrid Search 等；
- 检索结果是“最相关的知识片段集合”，作为上下文供 LLM 使用。

---

#### ⑤ 构建提示词（Prompt Injection）

将召回内容组织为上下文，并注入提示词模板中，例如：
```
以下是公司内部报销制度相关信息，请基于此回答用户问题：
【片段1】
【片段2】
【片段3】

问题：公司如何报销差旅费？
请根据以上内容作答，不要编造。
```
这一过程叫做RAG框架的Context Injection。

#### ⑥ 语言模型生成回答（LLM Answer）

- LLM 读取注入上下文的 Prompt，结合语义生成机制；
- 输出自然语言的回答，体现出逻辑性、完整性与语气控制；
- 此时的输出结果具备“**可溯源性**”与“**上下文相关性**”，也即回答可追溯知识来源。

---

#### ⑦ 可选：结果优化或多轮互动

Agent 可记录历史提问与回答，结合短期记忆进行多轮对话，也可引入用户反馈机制以优化知识召回。

---

### 🔖 总结

智能体调取知识库的全过程，本质是：

**将用户问题转化为向量 → 找到最相关的知识块 → 注入语言模型 → 输出答案**。

它是一种**将大模型生成能力与企业私有知识结合的有效策略**，是构建**可信任、可控的智能体系统**的基础。

### 1.1.3 知识库的作用

知识库为 Agent 提供了如下底层能力基础：

- **长期知识记忆**：避免大模型“遗忘”企业内训文档、制度规范、业务规范等；
- **可控知识来源**：所有内容均由用户上传、手动更新、可审计、可溯源、可更新；
- **结构化检索与召回**：支持语义级别的精准搜索，增强 Agent 问答的准确性与可解释性；
- **生成质量保障**：通过上下文增强（Context Augmentation）机制，提升回答可读性、可操作性；
- **知识可视化与管理**：系统支持多种格式文档管理（如 Word/PDF/网页/Notion），便于多源统一调度。

---

#### （1）系统功能作用概览

| 功能维度   | 具体作用说明                                             | 技术体积形式                          |
|------------|----------------------------------------------------------|---------------------------------------|
| 信息存储   | 保存企业内部培训类、业务文档、制度规范、FAQ资料等         | 文本上传、内容分段、版本管理         |
| 知识匹配   | 支持语义检索与向量匹配，支持上下文召回                   | 向量生成、ANN检索、关键词召回等     |
| 响应增强   | 提升回答准确性与完整性，避免幻觉、增强语言表达能力         | Prompt 注入上下文、RAG调用流程       |
| 输出一致性 | 保证语气风格统一、逻辑连贯、内容完整                      | 模板提示生成、上下文融合机制         |
| 知识更新   | 文档替换/增删模块内容，支持定期更新维护                   | 文档版本维护、结构化管理              |
| 数据反馈与优化 | 基于用户历史提问和反馈优化召回逻辑和文档组织结构        | 用户行为采集、反馈建模、指标迭代优化 |

#### （2）智能体在实际场景中调用知识库的关键作用

知识库已在多个垂直场景中发挥以下关键价值：

- **客服问诊**：在 AI 客服场景中，Agent 利用知识库实时检索 FAQ、流程指引、术语释义等内容，提供快速响应，降低人工成本。
- **产品问询**：用户向产品型 Bot 提问产品功能、参数、兼容性等问题时，Agent 可从产品知识库中提取对应答案，显著提升用户体验。
- **落地执行**：在流程型 Bot 中（如审批 Bot、派单 Bot），知识库承担“规则解释”角色，支持智能推理、自动判断、给出操作建议。
- **医疗问诊**：Agent 可调用医学知识库解答检查结果、用药建议、术后护理等讯问，保障医疗类 Bot 的准确性和合规性。
- **金融咨询**：金融场景下，Agent 可以接入银行、保险、财务、税务等模块化知识，结合用户输入信息，进行定制化解答与决策建议。

---

| 应用场景 | 典型应用内容说明 | 示例调用方式 |
|----------|------------------|----------------|
| 客服问诊 | 查询培训资料、制度政策、账户规则、操作步骤等内容 | ChatBot接入知识库，语义召回 FAQ |
| 产品问询 | 复杂产品参数说明、技术规格、适用范围等 | 将知识库结构化内容转为产品问答能力作为底层支撑 |
| 落地执行 | Bot根据规则库配置需要的流程判断、是否达到派单或审批条件 | 调用规则知识库，配合判断策略，输出执行建议 |
| 医疗问诊 | 医疗术语解释、检测指标释义、用药用量与建议 | 检查结果解读 Bot 使用医学知识库作为应答基础 |
| 金融咨询 | 税务规则、报销政策、薪酬算法、财报计算方式等 | 金融类 Agent 引用结构化规则知识，生成个性化建议 |

#### （3）知识库带来的系统性价值

- **泛化适配与高可用性增强**：通过统一的知识库接口，Agent 可被快速迁移到不同业务系统中；
- **响应一致性与标准性保证**：统一来源、统一规范，使输出结果在语气、内容、格式上保持一致；
- **助力业务流程协同**：用户关键信息结构化沉淀后，便于在多业务模块中共享调用；
- **辅助 Agent 进化为“专家型工具”**：配合提示词工程，知识库让 Agent 不再是“聊天工具”，而成为领域型助理。

---

## 1.2 CoreAgent 知识库实操

CoreAgent 提供了完整的低门槛知识库构建流程，从知识库创建、文件上传到语义分段与检索配置，支持用户高效完成可回溯、可溯源的语义知识体系统建。

---

### 1.2.1 知识库创建流程概览

| 操作步骤       | 核心任务描述                                             | 关键操作/界面或功能亮点               |
|----------------|----------------------------------------------------------|----------------------------------------|
| 创建知识库     | 新建知识库并填写基础信息，如名称、所属领域             | “创建知识库”弹窗，填写名称与描述      |
| 上传文档数据   | 选择上传文档来源方式，如 API、POPO、本地上传等         | 支持批量文档导入，支持 doc/pdf/html 等 |
| 内容分段定义   | 配置文档拆分逻辑，如按段落、标题、规则进行文本拆分     | 支持多种分段策略设置                   |
| 向量编码配置   | 连接 Embedding 模型（如 BGE），用于后续语义索引       | 向量模型配置                           |
| 检索策略配置   | 设置召回逻辑，如相似度排序、过滤条件、Re-rank等        | 检索策略配置 + Re-rank 支持            |
| 调用验证与发布 | 联调知识库调用效果，完成发布操作                        | 完整完成校验并推送                    |

#### ① 创建知识库

进入 CoreAgent 控制台左侧「知识库」模块，点击【创建知识库】。在弹出的对话框中填写：

- **知识库名称**  
  （必填）：建议使用语义明确、方便后期管理的命名；

- **知识库描述**  
  （选填）：可标注文档来源、适用 Agent 业务等元信息。

点击【保存】，完成知识库初始化。

---

#### ② 上传文本文档（选择数据源）

系统支持多种上传方式：

- **本地上传**：支持 `.doc`, `.pdf`, `.md`, `.html`, `.xlsx`, `.pptx`, `.jpg`, `.png` 等多格式文档；
- **外部链接接入**：支持通过 API、网页链接、数据库连接方式导入外部知识源；
- **容量限制**：
  - 支持单库最大 100MB；
  - 单文件 ≤ 50 万字；
  - 单图像 ≤ 5MB。

点击下一步进入知识处理阶段。
#### ③ 内容分段设置

在知识处理页面，配置内容分段策略：

- **动态分块**：系统根据文档结构、逻辑段落和内容长度自动划分文本块；
- **增强选项**：支持开启“图片识别”、“表格识别”、“特殊字符处理”；
- **可选设置向量模型**（如 BGE）：用于后续语义检索。

如无特殊需要，保持默认设置即可。

点击【下一步】。

---

#### ④ 检查分段效果

可通过右侧预览区域查看每条分块内容是否逻辑清晰、含义完整：

- 若需微调分区逻辑，可返回上一步重新设置块长；
- 合理划分有助于后续语义召回的准确性与回答上下文完整性。
#### ⑤ 配置召回检索策略

进入【检索设置】界面：

- **启用混合检索**：融合关键词词与语义搜索；
- **设置重排序逻辑（Rerank）**：提升召回内容与用户问题的语义贴合度；
- **配置参数**：

  - **最大召回段数（Top K）**：推荐设置为 `10`；
  - **段落相似度阈值（Score）**：推荐设置为 `0.1`；
  - **最大文本长度（Token）**：推荐 ≤ `8000`；
  - **是否开启关键词过滤**：可选。

点击【完成并处理】，系统自动向量化并建立索引，知识库正式可用。
### 1.2.2 知识库的维护

当知识库创建流程完成，用户可在 CoreAgent 控制台进入知识库管理页，执行进一步的维护操作，配置后续工作。此环节主要包含以下几个方面：

| 功能模块       | 作用说明 | 常用管理操作举例 |
|----------------|----------|------------------|
| 文档数据管理   | 增量上传文档/知识段（如每日同步外部知识） | 删除、替换、标注来源 |
| 分段策略管理   | 对历史文档的分段重新配置，适用于内容结构变化或模型精度提升场景 | 批量重切 |
| 向量模型管理   | 更换新的 Embedding 模型（如升级版本） | 重新向量化 |
| 检索策略管理   | 微调 TopK、Score 等策略参数 | 调整检索阈值 |
| 使用权限管理   | 配置知识库可见范围、操作权限 | 配置 Agent 调用权限 |
| API 授权配置   | 支持将知识库开放为 API 能力使用 | 查看 API 接口文档 |

---

#### ① 进入知识库详情页

在左侧导航栏点击【知识库】> 选择目标知识库（如 CoreAgent 知识库示例），进入详情页。

你可以看到：

- 文档列表、分段状态、知识块字段等信息；
- 元数据：知识库 ID、名称、描述。

---

#### ② 编辑文档段落内容

点击【编辑】，可对知识块内容字段进行编辑，更新字段信息（如 title、tag、token 统计等）。

> 特别说明：修改段落不会影响原始文档内容，更新后可立即生效。

---

#### ③ 调试检索预览结果

点击【检索调试】按钮，可快速调测某问题对知识库段落的召回结果，并可显示得分与语义召回片段。

---

#### ④ API 测试联调

在【API 调用配置】中获取 API 地址、Token，并可进行调试测试。

---

### 1.2.3 知识库使用

当知识库部署完成后，Agent 将可通过调用“知识库检索+注入”的模式实现增强问答。你将看到两个入口：

- CoreAgent 控制台：支持文档上传、段落编辑、分段检索、实时问答调试；
- 业务集成使用：可嵌入外部系统进行问答能力调度。

---

#### 智能体工作流中集成知识库（知识增强节点）

> 在 CoreAgent 的 Chatflow 编辑器中，用户可以插入【知识增强节点】，用于检索知识库并注入 LLM Prompt。

使用方法：

1. 打开 Chatflow，进入中间节点；
2. 插入【知识增强节点】；
3. 配置知识库 ID、TopK 等参数；
4. 调试对话串联效果，例如“取数能力是什么”；
5. 设置回答逻辑（系统提示词）、输出变量定义（如填至 LLM、HTTP 请求链路）；

---

#### 多节点组合调用：实现复杂交互流程

知识库调用通常配合以下下游执行节点，形成完整智能体流程，常见 Agent 结构如：

| 处理节点 | 说明           | 常见用途举例 |
|----------|----------------|---------------|
| 知识检索 | 从知识库召回语义片段 | 工单分类问答、报销政策匹配 |
| LLM问答 | 注入 Prompt + 上下文生成回复 | 文档摘要、术语解释 |
| 接口调用 | 基于用户问题调用接口 | 工单录入、字段填充 |

---

### 1.2.2 知识库的维护

当知识库创建流程完成，用户可在 CoreAgent 控制台进入知识库管理页，执行进一步的维护操作，配置后续工作。此环节主要包含以下几个方面：

| 功能模块       | 作用说明 | 常用管理操作举例 |
|----------------|----------|------------------|
| 文档数据管理   | 增量上传文档/知识段（如每日同步外部知识） | 删除、替换、标注来源 |
| 分段策略管理   | 对历史文档的分段重新配置，适用于内容结构变化或模型精度提升场景 | 批量重切 |
| 向量模型管理   | 更换新的 Embedding 模型（如升级版本） | 重新向量化 |
| 检索策略管理   | 微调 TopK、Score 等策略参数 | 调整检索阈值 |
| 使用权限管理   | 配置知识库可见范围、操作权限 | 配置 Agent 调用权限 |
| API 授权配置   | 支持将知识库开放为 API 能力使用 | 查看 API 接口文档 |

---

#### ① 进入知识库详情页

在左侧导航栏点击【知识库】> 选择目标知识库（如 CoreAgent 知识库示例），进入详情页。

你可以看到：

- 文档列表、分段状态、知识块字段等信息；
- 元数据：知识库 ID、名称、描述。

---

#### ② 编辑文档段落内容

点击【编辑】，可对知识块内容字段进行编辑，更新字段信息（如 title、tag、token 统计等）。

> 特别说明：修改段落不会影响原始文档内容，更新后可立即生效。

---

#### ③ 调试检索预览结果

点击【检索调试】按钮，可快速调测某问题对知识库段落的召回结果，并可显示得分与语义召回片段。

---

#### ④ API 测试联调

在【API 调用配置】中获取 API 地址、Token，并可进行调试测试。

---

### 1.2.3 知识库使用

当知识库部署完成后，Agent 将可通过调用“知识库检索+注入”的模式实现增强问答。你将看到两个入口：

- CoreAgent 控制台：支持文档上传、段落编辑、分段检索、实时问答调试；
- 业务集成使用：可嵌入外部系统进行问答能力调度。

---

#### 智能体工作流中集成知识库（知识增强节点）

> 在 CoreAgent 的 Chatflow 编辑器中，用户可以插入【知识增强节点】，用于检索知识库并注入 LLM Prompt。

使用方法：

1. 打开 Chatflow，进入中间节点；
2. 插入【知识增强节点】；
3. 配置知识库 ID、TopK 等参数；
4. 调试对话串联效果，例如“取数能力是什么”；
5. 设置回答逻辑（系统提示词）、输出变量定义（如填至 LLM、HTTP 请求链路）；

---

#### 多节点组合调用：实现复杂交互流程

知识库调用通常配合以下下游执行节点，形成完整智能体流程，常见 Agent 结构如：

| 处理节点 | 说明           | 常见用途举例 |
|----------|----------------|---------------|
| 知识检索 | 从知识库召回语义片段 | 工单分类问答、报销政策匹配 |
| LLM问答 | 注入 Prompt + 上下文生成回复 | 文档摘要、术语解释 |
| 接口调用 | 基于用户问题调用接口 | 工单录入、字段填充 |

---